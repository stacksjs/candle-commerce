// @bun
import{Od as E,Ud as v}from"./chunk-0gcz8bd6.js";import"./chunk-jpw6wb6x.js";import{Zd as O}from"./chunk-5b5bjkxb.js";import{_d as $}from"./chunk-mp45a05d.js";import{ae as k,fe as C}from"./chunk-1krazvx7.js";var u=k($(),1);var q=k(O(),1),z=k($(),1);var U=k(O(),1),j=k($(),1),V=(y,w,_)=>{let I={EcsContainer:async(b)=>{let{fromHttp:x}=await import("./chunk-2dd8ars7.js"),{fromContainerMetadata:A}=await import("./chunk-ba2f3xh4.js");return _?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>j.chain(x(b??{}),A(b))().then(R)},Ec2InstanceMetadata:async(b)=>{_?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");let{fromInstanceMetadata:x}=await import("./chunk-ba2f3xh4.js");return async()=>x(b)().then(R)},Environment:async(b)=>{_?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");let{fromEnv:x}=await import("./chunk-ypwy2myj.js");return async()=>x(b)().then(R)}};if(y in I)return I[y];else throw new j.CredentialsProviderError(`Unsupported credential source in profile ${w}. Got ${y}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:_})},R=(y)=>U.setCredentialFeature(y,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p");var X=(y,{profile:w="default",logger:_}={})=>{return Boolean(y)&&typeof y==="object"&&typeof y.role_arn==="string"&&["undefined","string"].indexOf(typeof y.role_session_name)>-1&&["undefined","string"].indexOf(typeof y.external_id)>-1&&["undefined","string"].indexOf(typeof y.mfa_serial)>-1&&(d(y,{profile:w,logger:_})||n(y,{profile:w,logger:_}))},d=(y,{profile:w,logger:_})=>{let I=typeof y.source_profile==="string"&&typeof y.credential_source==="undefined";if(I)_?.debug?.(`    ${w} isAssumeRoleWithSourceProfile source_profile=${y.source_profile}`);return I},n=(y,{profile:w,logger:_})=>{let I=typeof y.credential_source==="string"&&typeof y.source_profile==="undefined";if(I)_?.debug?.(`    ${w} isCredentialSourceProfile credential_source=${y.credential_source}`);return I},Y=async(y,w,_,I={})=>{_.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");let b=w[y],{source_profile:x,region:A}=b;if(!_.roleAssumer){let{getDefaultRoleAssumer:K}=await import("./chunk-vpthsph9.js");_.roleAssumer=K({..._.clientConfig,credentialProviderLogger:_.logger,parentClientConfig:{..._?.parentClientConfig,region:A??_?.parentClientConfig?.region}},_.clientPlugins)}if(x&&x in I)throw new z.CredentialsProviderError(`Detected a cycle attempting to resolve credentials for profile ${E(_)}. Profiles visited: `+Object.keys(I).join(", "),{logger:_.logger});_.logger?.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${x?`source_profile=[${x}]`:`profile=[${y}]`}`);let T=x?L(x,w,_,{...I,[x]:!0},W(w[x]??{})):(await V(b.credential_source,y,_.logger)(_))();if(W(b))return T.then((K)=>q.setCredentialFeature(K,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));else{let K={RoleArn:b.role_arn,RoleSessionName:b.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:b.external_id,DurationSeconds:parseInt(b.duration_seconds||"3600",10)},{mfa_serial:B}=b;if(B){if(!_.mfaCodeProvider)throw new z.CredentialsProviderError(`Profile ${y} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:_.logger,tryNextLink:!1});K.SerialNumber=B,K.TokenCode=await _.mfaCodeProvider(B)}let P=await T;return _.roleAssumer(P,K).then((N)=>q.setCredentialFeature(N,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},W=(y)=>{return!y.role_arn&&!!y.credential_source};var Z=k(O(),1),H=(y)=>Boolean(y)&&typeof y==="object"&&typeof y.credential_process==="string",c=async(y,w)=>import("./chunk-5mz99nq5.js").then(({fromProcess:_})=>_({...y,profile:w})().then((I)=>Z.setCredentialFeature(I,"CREDENTIALS_PROFILE_PROCESS","v")));var G=k(O(),1),S=async(y,w,_={})=>{let{fromSSO:I}=await import("./chunk-gmbqp439.js");return I({profile:y,logger:_.logger,parentClientConfig:_.parentClientConfig,clientConfig:_.clientConfig})().then((b)=>{if(w.sso_session)return G.setCredentialFeature(b,"CREDENTIALS_PROFILE_SSO","r");else return G.setCredentialFeature(b,"CREDENTIALS_PROFILE_SSO_LEGACY","t")})},F=(y)=>y&&(typeof y.sso_start_url==="string"||typeof y.sso_account_id==="string"||typeof y.sso_session==="string"||typeof y.sso_region==="string"||typeof y.sso_role_name==="string");var M=k(O(),1),J=(y)=>Boolean(y)&&typeof y==="object"&&typeof y.aws_access_key_id==="string"&&typeof y.aws_secret_access_key==="string"&&["undefined","string"].indexOf(typeof y.aws_session_token)>-1&&["undefined","string"].indexOf(typeof y.aws_account_id)>-1,Q=async(y,w)=>{w?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");let _={accessKeyId:y.aws_access_key_id,secretAccessKey:y.aws_secret_access_key,sessionToken:y.aws_session_token,...y.aws_credential_scope&&{credentialScope:y.aws_credential_scope},...y.aws_account_id&&{accountId:y.aws_account_id}};return M.setCredentialFeature(_,"CREDENTIALS_PROFILE","n")};var h=k(O(),1),D=(y)=>Boolean(y)&&typeof y==="object"&&typeof y.web_identity_token_file==="string"&&typeof y.role_arn==="string"&&["undefined","string"].indexOf(typeof y.role_session_name)>-1,m=async(y,w)=>import("./chunk-z8j1hpm6.js").then(({fromTokenFile:_})=>_({webIdentityTokenFile:y.web_identity_token_file,roleArn:y.role_arn,roleSessionName:y.role_session_name,roleAssumerWithWebIdentity:w.roleAssumerWithWebIdentity,logger:w.logger,parentClientConfig:w.parentClientConfig})().then((I)=>h.setCredentialFeature(I,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q")));var L=async(y,w,_,I={},b=!1)=>{let x=w[y];if(Object.keys(I).length>0&&J(x))return Q(x,_);if(b||X(x,{profile:y,logger:_.logger}))return Y(y,w,_,I);if(J(x))return Q(x,_);if(D(x))return m(x,_);if(H(x))return c(_,y);if(F(x))return await S(y,x,_);throw new u.CredentialsProviderError(`Could not resolve credentials using profile: [${y}] in configuration/credentials file(s).`,{logger:_.logger})};var ky=(y={})=>async({callerClientConfig:w}={})=>{let _={...y,parentClientConfig:{...w,...y.parentClientConfig}};_.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");let I=await v(_);return L(E({profile:y.profile??w?.profile}),I,_)};export{ky as fromIni};
